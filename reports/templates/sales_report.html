{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4">Sales Report</h2>
  <button class="btn btn-success" onclick="printReport()">üñ®Ô∏è Print Report</button>
  <!-- Report Form -->
  <form method="get" class="mb-4" novalidate>
    {% crispy form %}
  </form>

  {% if sales %}
  <table class="table table-striped mt-4">
    <thead class="table-light">
      <tr>
        <th>Date</th>
        <th>Customer</th>
        <th>Product</th>
        <th>Quantity</th>
        <th>Total Price</th>
        <th>Transport Included</th>
      </tr>
    </thead>
    <tbody>
      {% for sale in sales %}
      <tr>
        <td>{{ sale.date }}</td>
        <td>{{ sale.customer_name }}</td>
        <td>{{ sale.product.name }}</td>
        <td>{{ sale.quantity }}</td>
        <td>{{ sale.total_price }}</td>
        <td>{{ sale.transport_included|yesno:"Yes,No" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="mt-4">
    <p><strong>Total Sales:</strong> {{ total_sales }}</p>
    <p><strong>Total Items Sold:</strong> {{ total_items_sold }}</p>
    <p><strong>Transport Revenue:</strong> {{ transport_revenue }}</p>
  </div>
  {% else %}
    <p>No sales data available for the selected period.</p>
  {% endif %}
</div>



<script>
function printReport() {
  const reportContent = document.getElementById('sales-report').innerHTML;
  const printWindow = window.open('', '', 'width=900,height=650');
  printWindow.document.write(`
    <html>
      <head>
        <title>Sales Report</title>
        <style>
          body { font-family: Arial, sans-serif; margin: 30px; }
          h1 { text-align: center; }
          table { width: 100%; border-collapse: collapse; margin-top: 20px; }
          th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
          th { background-color: #f8f8f8; }
          img.logo { display: block; margin: 0 auto 10px; width: 100px; }
        </style>
      </head>
      <body>
        <h1>Mayondo Wood and Furniture</h1>
        <p style="text-align:center;">Sales Report - ${new Date().toLocaleDateString()}</p>
        ${reportContent}
      </body>
    </html>
  `);
  printWindow.document.close();
  printWindow.print();
}
</script>
{% endblock %}
